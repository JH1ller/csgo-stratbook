(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-31318a84"],{"899b":function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n=a("2b0e"),s="2.2.2",i=/^2\./.test(n["default"].version);i||n["default"].util.warn("VueClickaway "+s+" only supports Vue 2.x, and does not support Vue "+n["default"].version);var o="_vue_clickaway_handler";function l(e,t,a){r(e);var n=a.context,s=t.value;if("function"===typeof s){var i=!1;setTimeout((function(){i=!0}),0),e[o]=function(t){var a=t.path||(t.composedPath?t.composedPath():void 0);if(i&&(a?a.indexOf(e)<0:!e.contains(t.target)))return s.call(n,t)},document.documentElement.addEventListener("click",e[o],!1)}}function r(e){document.documentElement.removeEventListener("click",e[o],!1),delete e[o]}var c={bind:l,update:function(e,t){t.value!==t.oldValue&&l(e,t)},unbind:r};Array.from||(Array.from=e=>[].slice.call(e)),Array.isArray||(Array.isArray=e=>"[object Array]"===Object.prototype.toString.call(e));const u=Array.from,h=Array.isArray,m={ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40},d=(e,t)=>!(!e||"function"!==typeof e.contains)&&e.contains(t),v=(e,t,a)=>{e&&e.addEventListener&&e.addEventListener(t,a)},f=(e,t,a)=>{e&&e.removeEventListener&&e.removeEventListener(t,a)},p=e=>(e||[]).filter(g),b=e=>S(e)?e.getBoundingClientRect():null,S=e=>Boolean(e&&e.nodeType===Node.ELEMENT_NODE),g=e=>{if(!S(e)||!d(document.body,e))return!1;if("none"===e.style.display)return!1;const t=b(e);return Boolean(t&&t.height>0&&t.width>0)},y=(e,t)=>u((S(t)?t:document).querySelectorAll(e)),w=(e,t,a)=>{t&&S(e)&&e.setAttribute(t,a)},E=(e,t)=>{let a=e.parentElement;while(null!==a&&!a.classList.contains(t))a=a.parentElement;return a},N=(e,t={},a={},n={})=>{const s=a[e]||n[e];return"function"===typeof s?s(t):s};var _={directives:{onClickaway:c},props:{closeOnClick:{type:Boolean,default:!0},closeOnScroll:{type:Boolean,default:!0},lazy:{type:Boolean,default:!1},itemSelector:{type:[String,Array],default:()=>[".v-context-item",".v-context > li > a"]},role:{type:String,default:"menu"},subMenuOffset:{type:Number,default:10},useScrollHeight:{type:Boolean,default:!1},useScrollWidth:{type:Boolean,default:!1},heightOffset:{type:Number,default:25},widthOffset:{type:Number,default:25},tag:{type:String,default:"ul"}},computed:{style(){return this.show?{top:this.top+"px",left:this.left+"px"}:null}},data(){return{top:null,left:null,show:!1,data:null,localItemSelector:"",activeSubMenu:null}},created(){this.localItemSelector=this.mapItemSelector(this.itemSelector)},beforeDestroy(){this.closeOnScroll&&this.removeScrollEventListener()},methods:{addScrollEventListener(){v(window,"scroll",this.close)},addHoverEventListener(e){e.querySelectorAll(".v-context__sub").forEach(e=>{v(e,"mouseenter",this.openSubMenu),v(e,"mouseleave",this.closeSubMenu)})},close(){if(this.show){while(null!==this.activeSubMenu)E(this.activeSubMenu,"v-context__sub").dispatchEvent(new Event("mouseleave"));this.resetData(),this.removeHoverEventListener(this.$el),this.closeOnScroll&&this.removeScrollEventListener(),this.$emit("close")}},focusItem(e,t){const a=t.find((t,a)=>a===e);a&&a.focus()},focusNext(e,t){this.show&&(e.preventDefault(),e.stopPropagation(),this.$nextTick(()=>{const a=this.getItems();if(a.length<1)return;let n=a.indexOf(e.target);t&&n>0?n--:!t&&n<a.length-1&&n++,n<0&&(n=0),this.focusItem(n,a)}))},getItems(){return p(y(this.localItemSelector,this.activeSubMenu||this.$el))},mapItemSelector(e){return h(e)&&(e=e.map(e=>e+":not(.disabled):not([disabled])").join(", ")),e},onClick(){this.close()},onKeydown(e){const t=e.keyCode;if(t===m.ESC)this.close();else if(t===m.DOWN)this.focusNext(e,!1);else if(t===m.UP)this.focusNext(e,!0);else if(t===m.RIGHT){const t=E(e.target,"v-context__sub");t&&t.getElementsByClassName("v-context")[0]!==this.activeSubMenu&&(t.dispatchEvent(new Event("mouseenter")),this.focusNext(e,!1))}else if(t===m.LEFT){if(!this.activeSubMenu)return;const e=E(this.activeSubMenu,"v-context__sub");e.dispatchEvent(new Event("mouseleave"));const t=this.getItems(),a=t.indexOf(e.getElementsByTagName("a")[0]);this.focusItem(a,t)}},open(e,t){this.data=t,this.show=!0,this.$nextTick(()=>{[this.top,this.left]=this.positionMenu(e.clientY,e.clientX,this.$el),this.$el.focus(),this.setItemRoles(),this.addHoverEventListener(this.$el),this.closeOnScroll&&this.addScrollEventListener(),this.$emit("open",e,this.data,this.top,this.left)})},openSubMenu(e){const t=this.getSubMenuElementByEvent(e),a=E(t.parentElement,"v-context"),n=b(e.target);if(this.activeSubMenu!==a)while(null!==this.activeSubMenu&&this.activeSubMenu!==a&&this.activeSubMenu!==t)E(this.activeSubMenu,"v-context__sub").dispatchEvent(new Event("mouseleave"));t.style.display="block";let[s,i]=this.positionMenu(n.top,n.right-this.subMenuOffset,t);t.style.left=i+"px",t.style.top=s+"px",this.activeSubMenu=t},closeSubMenu(e){const t=this.getSubMenuElementByEvent(e),a=E(t,"v-context");if(this.activeSubMenu!==t)while(null!==this.activeSubMenu&&this.activeSubMenu!==t)E(this.activeSubMenu,"v-context__sub").dispatchEvent(new Event("mouseleave"));t.style.display="none",this.activeSubMenu=a&&E(a,"v-context__sub")?a:null},getSubMenuElementByEvent(e){return e.target.getElementsByTagName("ul")[0]},positionMenu(e,t,a){const n=this.useScrollHeight?a.scrollHeight:a.offsetHeight,s=window.innerHeight-n-this.heightOffset,i=this.useScrollWidth?a.scrollWidth:a.offsetWidth,o=window.innerWidth-i-this.widthOffset;return e>s&&(e=s),t>o&&(t=o),[e,t]},removeScrollEventListener(){f(window,"scroll",this.close)},removeHoverEventListener(e){e.querySelectorAll(".v-context__sub").forEach(e=>{f(e,"mouseenter",this.openSubMenu),f(e,"mouseleave",this.closeSubMenu)})},resetData(){this.top=null,this.left=null,this.data=null,this.show=!1},setItemRoles(){y(this.localItemSelector,this.$el).forEach(e=>{w(e,"role","menuitem"),w(e,"tabindex","-1")})}},watch:{closeOnScroll(e,t){e!==t&&(e&&this.show?this.addScrollEventListener():this.removeScrollEventListener())},itemSelector(e,t){e!==t&&(this.localItemSelector=this.mapItemSelector(e))}},render(e){if(this.lazy&&!this.show)return e(!1);const t={"!contextmenu":e=>{e.preventDefault()},keydown:this.onKeydown};this.closeOnClick&&(t.click=this.onClick);const a=[{name:"on-clickaway",value:this.close,rawName:"v-on-clickaway"}];return this.lazy||a.push({name:"show",value:this.show,rawName:"v-show",expression:"show"}),e(this.tag,{staticClass:"v-context",style:this.style,attrs:{tabindex:"-1",role:this.role,"aria-hidden":this.lazy?null:String(!this.show)},on:t,directives:a},[N("default",{data:this.data},this.$scopedSlots,this.$slots)])}}},"9f98":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"map-view"},[a("SketchTool",{attrs:{map:e.map,userName:e.userName,stratName:e.stratName,roomId:e.roomId,showConfigBtn:!0},on:{"show-connection-dialog":function(t){e.showConnectionDialog=!0},"update-room-id":e.changeRoomId,"update-strat-name":e.changeStratName,"update-map":e.changeMap}}),e.showConnectionDialog?a("ConnectionDialog",{attrs:{userName:e.userName,stratName:e.stratName},on:{submit:e.handleSubmit,close:function(t){e.showConnectionDialog=!1}}}):e._e(),a("div",{staticClass:"map-view__map-btn",on:{click:function(t){return t.preventDefault(),e.openContextMenu(t)}}},[a("SmartImage",{staticClass:"map-view__map-img",attrs:{src:e.mapImage}}),a("span",{staticClass:"map-view__map-label"},[e._v(e._s(e.mapTable[e.map]))])],1),a("vue-context",{ref:"mapPicker"},e._l(Object.entries(e.mapTable),(function(t){var n=t[0],s=t[1];return a("li",{key:n,staticClass:"map-view__context-link",attrs:{disabled:!["DUST_2","MIRAGE"].includes(n)}},[a("a",{on:{click:function(t){e.map=n}}},[e._v(" "+e._s(s)+" ")])])})),0)],1)},s=[],i=a("d4ec"),o=a("bee2"),l=a("262e"),r=a("2caf"),c=(a("d81d"),a("5319"),a("ac1f"),a("b0c0"),a("fb6a"),a("9ab4")),u=a("60a3"),h=a("ba13"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("BackdropDialog",[a("TextInput",{staticClass:"connection-dialog__text-field",attrs:{field:e.formFields.userName},model:{value:e.formFields.userName.value,callback:function(t){e.$set(e.formFields.userName,"value",t)},expression:"formFields.userName.value"}}),a("TextInput",{staticClass:"connection-dialog__text-field",attrs:{field:e.formFields.stratName},model:{value:e.formFields.stratName.value,callback:function(t){e.$set(e.formFields.stratName,"value",t)},expression:"formFields.stratName.value"}}),a("div",{staticClass:"connection-dialog__actions"},[a("button",{staticClass:"connection-dialog__btn-submit",on:{click:e.handleSubmitAttempt}},[e._v("Submit")]),a("button",{staticClass:"connection-dialog__btn-cancel",on:{click:e.close}},[e._v("Cancel")])])],1)},d=[],v=a("652a"),f=a("4c1e"),p=a("f5e2"),b=a("caeb"),S=a("e1bd"),g=a("dd8e"),y=function(e){Object(l["a"])(a,e);var t=Object(r["a"])(a);function a(){var e;return Object(i["a"])(this,a),e=t.apply(this,arguments),e.formFields={userName:new b["a"]("Username",!0,[p["a"].maxLength(30),p["a"].notEmpty()]),stratName:new b["a"]("Strat name",!1,[p["a"].maxLength(30)])},e}return Object(o["a"])(a,[{key:"handleSubmitAttempt",value:function(){Object(p["b"])(this.formFields)&&this.submit()}},{key:"submit",value:function(){return{userName:this.formFields.userName.value,stratName:this.formFields.stratName.value}}},{key:"mounted",value:function(){var e;this.formFields.userName.value=null!==(e=this.userName)&&void 0!==e?e:"User_".concat(Object(S["a"])(5)),this.formFields.stratName.value=this.stratName}}]),a}(Object(u["d"])(g["a"]));Object(c["b"])([Object(u["e"])()],y.prototype,"userName",void 0),Object(c["b"])([Object(u["e"])()],y.prototype,"stratName",void 0),Object(c["b"])([Object(u["b"])()],y.prototype,"submit",null),y=Object(c["b"])([Object(u["a"])({components:{BackdropDialog:v["a"],TextInput:f["a"]}})],y);var w=y,E=w,N=(a("a57a"),a("2877")),_=Object(N["a"])(E,m,d,!1,null,null,null),x=_.exports,O=a("0a4f"),k=a("899b"),M=a("86d1"),I=a("ed7c"),C=a("8d6a"),j=function(e){Object(l["a"])(a,e);var t=Object(r["a"])(a);function a(){var e;return Object(i["a"])(this,a),e=t.apply(this,arguments),e.GameMap=M["a"],e.mapTable=M["b"],e.map=M["a"].Dust2,e.userName="",e.stratName="",e.roomId="",e.showConnectionDialog=!1,e}return Object(o["a"])(a,[{key:"handleSubmit",value:function(e){var t=e.userName,a=e.stratName;this.userName=t,this.stratName=a,this.storageService.set("draw-username",t),this.showConnectionDialog=!1}},{key:"changeRoomId",value:function(e){this.roomId=e,this.storageService.set("draw-room-id",e),this.$route.params.roomId||this.$router.replace({path:"/map/".concat(e)})}},{key:"changeStratName",value:function(e){this.stratName=e}},{key:"changeMap",value:function(e){C["a"].info("MapView::changeMap",e),this.map=e}},{key:"mapImage",get:function(){return"maps/".concat(this.map.toLowerCase(),".jpg")}},{key:"openContextMenu",value:function(e){e.preventDefault(),e.stopImmediatePropagation(),this.mapPicker.open(e)}},{key:"mounted",value:function(){var e,t,a=this.storageService.get("draw-username");(null===(e=this.profile)||void 0===e?void 0:e.name)?this.userName=this.profile.name:a&&(this.userName=a);var n=this.storageService.get("draw-room-id");if(this.$route.params.roomId)this.changeRoomId(this.$route.params.roomId);else if(null===(t=this.profile)||void 0===t?void 0:t.team)this.changeRoomId(this.profile.team.slice(0,10));else if(n)this.changeRoomId(n);else this.storageService.get("draw-data")}}]),a}(u["h"]);Object(c["b"])([Object(u["c"])()],j.prototype,"storageService",void 0),Object(c["b"])([O["b"].State],j.prototype,"profile",void 0),Object(c["b"])([Object(u["g"])()],j.prototype,"mapPicker",void 0),j=Object(c["b"])([Object(u["a"])({components:{SketchTool:h["a"],ConnectionDialog:x,VueContext:k["a"],SmartImage:I["a"]}})],j);var L=j,D=L,T=(a("b4bc"),Object(N["a"])(D,n,s,!1,null,null,null));t["default"]=T.exports},a57a:function(e,t,a){"use strict";a("f654c")},b4bc:function(e,t,a){"use strict";a("b6ea")},b6ea:function(e,t,a){},f654c:function(e,t,a){}}]);